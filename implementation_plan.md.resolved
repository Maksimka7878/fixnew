# Implementation Plan: Russian Payment Systems Integration (YooKassa)

## Goal
Integrate real payment processing for the Russian market, supporting **Bank Cards (Mir, Visa, MC)** and **SBP (Fast Payment System)** using **YooKassa** (formerly Yandex.Checkout) as the provider.

> [!IMPORTANT]
> **Security Requirement**: Real payments require a **backend** to store API Secret Keys securely. We cannot do this client-side (in the browser) as it would expose our secrets. This plan includes setting up a lightweight backend (Node.js/Express).

## User Review Required
- [ ] **Provider Choice**: Confirm **YooKassa** is acceptable (Standard for RU, supports SBP & Cards).
- [ ] **Backend Hosting**: Currently running locally in `/server`. For production, this needs Vercel/VPS.
- [ ] **Secrets**: Update `/server/.env` with **REAL** YooKassa Test Mode keys to verify payments.

## Proposed Changes

### 1. Architecture: Backend Service (BFF)
**Status**: âœ… Initialized in `/server`.
- **Stack**: Node.js, Express, Cors, Axios.
- **Endpoints**:
    - `POST /api/payment/create`: Generates payment link.
    - `POST /api/payment/webhook`: Handles status updates.

### 2. Frontend Integration
#### [NEW] `src/api/payment.ts`
- Service to communicate with our backend server (`http://localhost:3001`).

#### [Modify] Checkout Logic (`CartPage` or `CartDrawer`)
- Add "Pay with Card / SBP" button.
- **Flow**:
    1. User clicks "Pay".
    2. Frontend calls `api/payment/create`.
    3. Backend returns `confirmationUrl`.
    4. Frontend redirects `window.location.href = confirmationUrl`.

### 3. Verification
- **Sandbox Mode**: Use YooKassa test bank card numbers.
- **SBP**: Verify QR code generation in sandbox.

## Next Steps
- [ ] Implement `src/api/payment.ts` on frontend.
- [ ] Connect "Pay" button in Cart.
